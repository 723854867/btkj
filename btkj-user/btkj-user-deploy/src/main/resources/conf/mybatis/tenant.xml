<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.btkj.user.persistence.dao.TenantDao">

	<select id="searchCount" parameterType="org.btkj.pojo.submit.TenantSearcher" resultType="int">
		SELECT COUNT(*) FROM (<include refid="searchSql" />) b
	</select>

	<select id="search" parameterType="org.btkj.pojo.submit.TenantSearcher" resultType="org.btkj.pojo.info.TenantListPc" >
		SELECT 
			*
		FROM 	
			(<include refid="searchSql" /> LIMIT #{start}, #{pageSize}) b
	</select> 

	<sql id="searchSql">
		SELECT 
			`tid`, 
			`name`, 
			`mobile`, 
			`permit_num`, 
			`created`, 
			`expire_date`, 
			`state` 
		FROM
			tenant 
		<where>
			<if test="null != tid">
				tid=#{tid}
			</if>
			<if test="null != name">
				name=#{name}
			</if>
			<if test="null != mobile">
				AND mobile=#{mobile}
			</if>
			<if test="null != permitNum">
				AND permit_num=#{permitNum}
			</if>
			<if test="null != state">
				AND `state`=#{state}
			</if>
		</where>
		<choose>
			<when test="order == null">
				<choose>
					<when test="null != asc">
						ORDER BY created ASC
					</when>
					<otherwise>
						ORDER BY created DESC
					</otherwise>
				</choose>
			</when>
			<otherwise>
				<choose>
					<when test="order == 'created'">
						<choose>
							<when test="null != asc">
								ORDER BY created ASC
							</when>
							<otherwise>
								ORDER BY created DESC
							</otherwise>
						</choose>
					</when>
					<otherwise>
						<choose>
							<when test="order == 'expireDate'">
								<choose>
									<when test="null != asc">
								ORDER BY expire_date ASC
									</when>
								<otherwise>
								ORDER BY expire_date DESC
							    </otherwise>
								</choose>
							</when>
						</choose>
					</otherwise>
				</choose>
			</otherwise>
		</choose>
	</sql>
</mapper>