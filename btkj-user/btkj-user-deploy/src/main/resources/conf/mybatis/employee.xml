<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.btkj.user.persistence.dao.EmployeeDao">

	<select id="searchCount" parameterType="org.btkj.pojo.submit.EmployeeSearcher" resultType="int">
		SELECT COUNT(*) FROM (<include refid="searchSql" />) b
	</select>

	<select id="search" parameterType="org.btkj.pojo.submit.EmployeeSearcher" resultType="org.btkj.pojo.info.EmployeeListInfo" >
		SELECT 
			b.`id`, 
			b.`uid`, 
			b.`name`, 
			b.`mobile`, 
			b.`identity`, 
			b.`created`, 
			b.`tag_mod`, 
			b.`state`, 
			b.`pay_type`, 
			b.`parent_id` pid, 
			a.`uid` puid, 
			a.`name` pname, 
			a.`mobile` pmobile
		FROM 
			employee a 
		RIGHT JOIN 
			(<include refid="searchSql" /> LIMIT #{start}, #{pageSize}) b
		ON a.id=b.parent_id
	</select> 

	<sql id="searchSql">
		SELECT 
			`id`, 
			`uid`, 
			`name`, 
			`mobile`, 
			`identity`, 
			`parent_id`, 
			`created`, 
			`tag_mod`, 
			`state`, 
			`pay_type` 
		FROM
			employee 
		<where>
			<if test="null != tid">
				tid=#{tid}
			</if>
			<if test="null != mobile">
				AND mobile=#{mobile}
			</if>
			<if test="null != employeeId">
				AND `id`=#{id}
			</if>
			<if test="null != name">
				AND `name`=#{name}
			</if>
			<if test="null != tagMod">
				AND tag_mod &amp; #{tagMod}=#{tagMod}
			</if>
			<if test="null != payType">
				AND pay_type=#{payType}
			</if>
		</where>
		<choose>
			<when test="order == null">
				<choose>
					<when test="null != asc">
						ORDER BY created ASC
					</when>
					<otherwise>
						ORDER BY created DESC
					</otherwise>
				</choose>
			</when>
			<otherwise>
				<choose>
					<when test="order == 'created'">
						<choose>
							<when test="null != asc">
								ORDER BY created ASC
							</when>
							<otherwise>
								ORDER BY created DESC
							</otherwise>
						</choose>
					</when>
				</choose>
			</otherwise>
		</choose>
	</sql>
</mapper>